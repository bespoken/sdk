image: node:10.16.3

cache:
  paths:
  - node_modules/

# We have two stages to force the jobs to run sequentially
stages:
  - tests
  - docs

tests:10.16.3:
  stage: tests
  script:
    - npm install
    - npm test
    - npm run codecov
  artifacts:
    paths:
      - test-report.xml
    reports:
      junit: test-report.xml
    expire_in: 30 days
  only:
    - pushes
    - merge_requests

tests:12.14.1:
  image: node:12.14.1
  stage: tests
  script:
    - npm install
    - npm test
  only:
    - pushes
    - merge_requests

pages:
  stage: docs
  script:
    - npm install
    - npm run docs
  artifacts:
    paths:
    - public
  only:
    - pushes
    - merge_requests
    - master